-- Map Load Detection Script
-- Detects if the game uses StreamingEnabled or distance-based map loading
-- Works in LocalScript or Command bar (Client)

local Players = game:GetService("Players")
local ReplicatedFirst = game:GetService("ReplicatedFirst")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local isStreaming = false
local testFinished = false

-- Step 1: Check StreamingEnabled flag
if Workspace.StreamingEnabled then
	isStreaming = true
	print("[DETECTION] StreamingEnabled = true (map loads based on distance)")
else
	print("[DETECTION] StreamingEnabled = false (full map *might* load)")
end

-- Step 2: Attempt to detect actual streaming behavior
task.spawn(function()
	local testDistance = 3000 -- how far to check for parts
	local totalParts = 0
	local farPartsFound = 0

	for _, part in pairs(Workspace:GetDescendants()) do
		if part:IsA("BasePart") then
			totalParts += 1
			local dist = (hrp.Position - part.Position).Magnitude
			if dist > testDistance then
				farPartsFound += 1
			end
		end
	end

	if totalParts == 0 then
		print("[DETECTION] Workspace empty â€” map may not be fully loaded yet.")
		testFinished = true
		return
	end

	print(string.format("[SCAN] Checked %d parts; %d were farther than %d studs.",
		totalParts, farPartsFound, testDistance))

	-- If we find *zero* far parts, it likely means they are being streamed out.
	if farPartsFound == 0 and Workspace.StreamingEnabled then
		print("[RESULT] Map is streaming. Only nearby parts are loaded.")
		isStreaming = true
	elseif farPartsFound > 0 then
		print("[RESULT] Full map appears loaded (no distance restriction).")
		isStreaming = false
	else
		print("[RESULT] Uncertain. Map might still be loading.")
	end

	testFinished = true
end)

-- Step 3: Optional live test â€” see if distant regions appear when moving
task.spawn(function()
	local initialCount = #Workspace:GetDescendants()
	task.wait(10)
	local laterCount = #Workspace:GetDescendants()

	if laterCount > initialCount + 50 then
		print("[LIVE CHECK] More parts appeared after moving or waiting â€” streaming confirmed.")
		isStreaming = true
	elseif laterCount < initialCount then
		print("[LIVE CHECK] Some parts unloaded â€” streaming confirmed.")
		isStreaming = true
	else
		print("[LIVE CHECK] Part count stable â€” likely full map load.")
	end
end)

-- Final result after delay
task.delay(12, function()
	print("\n====== MAP LOAD DETECTION RESULT ======")
	if isStreaming then
		warn("ðŸŸ  The game is using STREAMING â€” map only loads near the player.")
	else
		print("ðŸŸ¢ The full map appears to be LOADED and not distance-limited.")
	end
	print("=======================================")
end)
