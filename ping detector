local Players = game:GetService("Players")
local Stats = game:GetService("Stats")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "PlayerPingGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 320, 0, 220)
frame.Position = UDim2.fromScale(0.05, 0.3)
frame.BackgroundColor3 = Color3.fromRGB(20,20,20)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,0,0,30)
title.BackgroundTransparency = 1
title.Text = "Player Ping Viewer"
title.TextColor3 = Color3.new(1,1,1)
title.TextScaled = true
title.Font = Enum.Font.GothamBold

local list = Instance.new("ScrollingFrame", frame)
list.Position = UDim2.new(0,10,0,40)
list.Size = UDim2.new(0,130,1,-50)
list.CanvasSize = UDim2.new(0,0,0,0)
list.ScrollBarImageTransparency = 1
list.BackgroundTransparency = 1

local layout = Instance.new("UIListLayout", list)
layout.Padding = UDim.new(0,5)

local info = Instance.new("TextLabel", frame)
info.Position = UDim2.new(0,150,0,80)
info.Size = UDim2.new(0,160,0,80)
info.BackgroundTransparency = 1
info.TextColor3 = Color3.new(1,1,1)
info.TextScaled = true
info.Font = Enum.Font.GothamBold
info.Text = "Select a player"

local selected = nil

local function getPing()
	local stat = Stats.Network.ServerStatsItem:FindFirstChild("Data Ping")
	if not stat then return "--" end
	return stat:GetValueString()
end

local function addPlayer(p)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1,0,0,30)
	btn.Text = p.Name
	btn.Font = Enum.Font.Gotham
	btn.TextScaled = true
	btn.TextColor3 = Color3.new(1,1,1)
	btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
	btn.Parent = list

	btn.MouseButton1Click:Connect(function()
		selected = p
	end)
end

for _, p in ipairs(Players:GetPlayers()) do
	addPlayer(p)
end

Players.PlayerAdded:Connect(addPlayer)

layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
	list.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y + 5)
end)

RunService.RenderStepped:Connect(function()
	if selected then
		info.Text = selected.Name .. "\nPing: " .. getPing()
	end
end)
