-- Load Kavo UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Mob Teleport GUI", "DarkTheme")

-- Create tab + section
local TeleportTab = Window:NewTab("Teleport")
local TeleportSection = TeleportTab:NewSection("Mob Teleport")

-- Player reference
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

player.CharacterAdded:Connect(function(newChar)
    character = newChar
    hrp = character:WaitForChild("HumanoidRootPart")
end)

-- Function that refreshes mob targets
local function getTargets()
    local targets = {}

    -- Glutto2 Berry
    local ok1, mob1 = pcall(function()
        return workspace.Mobs.Glutto2.Glutto.Berry
    end)
    if ok1 and mob1 then table.insert(targets, mob1) end

    -- Glutto3 Body
    local ok2, mob2 = pcall(function()
        return workspace.Mobs.Glutto3.Glutto.Body
    end)
    if ok2 and mob2 then table.insert(targets, mob2) end

    -- Clerick2 HRP
    local ok3, mob3 = pcall(function()
        return workspace.Mobs.Clerick2.Clerick.HumanoidRootPart
    end)
    if ok3 and mob3 then table.insert(targets, mob3) end

    -- Glutto3 Berry child[3]
    local ok4, mob4parent = pcall(function()
        return workspace.Mobs.Glutto3.Glutto.Berry
    end)
    if ok4 and mob4parent then
        local kids = mob4parent:GetChildren()
        if kids[3] then table.insert(targets, kids[3]) end
    end

    -- Twigface Gardener Alert
    local ok5, mob5 = pcall(function()
        return workspace.Mobs.TwigfaceGardener4["Twigface Gardener"].Alert
    end)
    if ok5 and mob5 then table.insert(targets, mob5) end

    return targets
end

-- === ONE TOGGLE BUTTON ===
local teleporting = false
TeleportSection:NewToggle("Auto Teleport Behind Mobs", "Keeps teleporting behind all listed mobs", function(state)
    teleporting = state
    if teleporting then
        task.spawn(function()
            while teleporting do
                if hrp then
                    for _, mob in ipairs(getTargets()) do
                        if mob and mob:IsDescendantOf(workspace) then
                            hrp.CFrame = mob.CFrame * CFrame.new(0, 0, 5) -- behind mob
                            task.wait(0.3) -- short delay between mobs
                        end
                    end
                end
                task.wait(0.5) -- refresh rate
            end
        end)
    end
end)
